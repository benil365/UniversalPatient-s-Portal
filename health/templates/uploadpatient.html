{% extends 'base.html' %}
{% block content %}
<style>
  body {
    font-family: Arial, sans-serif;
    background: url("https://eac.ac.ke/wp-content/uploads/2019/08/CHRIT.jpg") no-repeat center center fixed;
    background-size: cover;
  }
  .dashboard-card {
    background: rgba(255,255,255,0.96);
    border-radius: 16px;
    box-shadow: 0 8px 32px 0 rgba(31,38,135,0.18);
    padding: 2rem 2.5rem;
    margin-top: 40px;
    margin-bottom: 40px;
  }
  .dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 24px;
    margin-top: 24px;
  }
  .dashboard-item {
    background: rgba(245,245,255,0.98);
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(31,38,135,0.10);
    padding: 24px 18px;
    transition: box-shadow 0.2s, background 0.2s;
    min-height: 180px;
  }
  .dashboard-item:hover {
    box-shadow: 0 4px 16px rgba(31,38,135,0.18);
    background: #f8f9fa;
  }
  .dashboard-item h2 {
    color: #007bff;
    font-weight: bold;
    margin-top: 0;
    margin-bottom: 12px;
  }
  .dashboard-item p, .dashboard-item ul {
    margin-bottom: 0;
    color: #343a40;
  }
  .dashboard-item ul {
    padding-left: 18px;
  }
  .post {
    background: #e9ecef;
    border-radius: 8px;
    margin: 12px 0;
    padding: 12px 16px;
    box-shadow: 0 1px 4px rgba(31,38,135,0.08);
  }
  .dashboard-links {
    margin-top: 32px;
    text-align: center;
  }
  .dashboard-links a {
    margin: 0 12px;
    color: #007bff;
    font-weight: bold;
    text-decoration: underline;
  }
  .contact-info {
    margin-top: 24px;
    text-align: center;
    color: #343a40;
  }
  .footer {
    background: #343a40;
    color: #fff;
    padding: 18px 0;
    margin-top: 40px;
    border-radius: 0 0 16px 16px;
    box-shadow: 0 -2px 8px rgba(0,0,0,0.08);
  }
</style>

<div class="container">
  <div class="dashboard-card mx-auto col-md-10 col-lg-8">
    <h1 class="display-4 text-primary font-weight-bold text-center mb-4">My Dashboard</h1>
    <div class="dashboard-grid">
      <div class="dashboard-item" id="uploads">
        <h2>My Medical Data</h2>
        <p>View your medical documents.</p>
        <ul>
          {% for file in uploaded_files %}
            <li>{{ file }}</li>
          {% empty %}
            <li>No documents found.</li>
          {% endfor %}
        </ul>
      </div>
      <div class="dashboard-item" id="hospitals">
        <h2>My Hospitals</h2>
        <p>Access information about your hospitals.</p>
        {% if user.user_type == 'patient' %}
          {% if num_hospitals == 0 %}
            <p>You have zero hospitals. <a href="#">Click here</a> to view all hospitals.</p>
          {% else %}
            <p>You have {{ num_hospitals }} hospitals.</p>
            {% for hospital in my_hospitals %}
              <p>{{ hospital.hospital_name }}</p>
            {% endfor %}
          {% endif %}
        {% endif %}
      </div>
      <div class="dashboard-item" id="subscriptions">
        <h2>My Subscriptions</h2>
        <p>Manage your subscription details.</p>
      </div>
      <div class="dashboard-item" id="reports">
        <h2>Reports</h2>
        <p>View, generate, and analyze your medical reports.</p>
      </div>
    </div>

    <div id="posts-container"></div>
    <div id="upload-message" class="mt-3 text-success text-center"></div>

    <div class="dashboard-links">
      <a href="{% url 'health:paswd_change' %}">Change Password</a>
      <a href="{% url 'health:Upload' %}">Health Document Upload</a>
      {% if user.is_authenticated %}
        <a href="{% url 'health:logout' %}">Logout</a>
      {% endif %}
    </div>

    <div class="contact-info">
      <p>For more information, contact us at <a href="mailto:benilinternational@gmail.com">benilinternational@gmail.com</a> or call <a href="tel:0115427807">+254115427807</a></p>
    </div>
  </div>
</div>

<div class="footer text-center">
  <small>&copy; 2023 Global Access. A BeniL International Product. All rights reserved.</small>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function() {
    fetchPosts();

    function fetchPosts() {
      $.ajax({
        url: '/get_posts/',
        type: 'GET',
        success: function(response) {
          var postsContainer = $('#posts-container');
          postsContainer.empty();
          for (var i = 0; i < response.length; i++) {
            var post = response[i];
            var postElement = $('<div>').addClass('post');
            postElement.append($('<h3>').text(post.title));
            postElement.append($('<p>').text(post.content));
            postsContainer.append(postElement);
          }
        },
        error: function(error) {
          console.log(error);
        }
      });
    }

    $('form').on('submit', function(e) {
      e.preventDefault();
      var fileInput = $('input[name="fileupload"]')[0];
      var file = fileInput.files[0];
      var formData = new FormData();
      formData.append('file', file);

      $.ajax({
        url: '/Upload/',
        type: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        success: function(response) {
          $('#upload-message').text('Upload successful');
          fileInput.value = '';
        },
        error: function(error) {
          console.log(error);
        }
      });
    });
  });
</script>
{% endblock content %}
